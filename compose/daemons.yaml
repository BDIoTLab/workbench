version: '3.6'

x-daemon: &peatio-daemon
  build:
    context: ../app/peatio
  restart: always
  depends_on:
    - peatio
    - db
    - redis
    - rabbitmq
    - geth
    - smtp_relay
    - barong
    - slanger
  env_file:
    - ../config/peatio.env
  volumes:
    - ../config/peatio:/opt/peatio/config:ro

services:
  deposit_coin_address:
    << : *peatio-daemon
    command: bash -c "bin/link_config && ruby lib/daemons/amqp_daemon.rb deposit_coin_address"

  withdraw_coin:
    << : *peatio-daemon
    command: bash -c "bin/link_config && ruby lib/daemons/amqp_daemon.rb withdraw_coin"

  withdraw_audit:
    << : *peatio-daemon
    command: bash -c "bin/link_config && ruby lib/daemons/withdraw_audit.rb"

  blockchain:
    << : *peatio-daemon
    command: bash -c "bin/link_config && ruby lib/daemons/blockchain.rb"
